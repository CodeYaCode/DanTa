<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.snda.cloud.virtulization.resource.dao.IBandwidthRIDao">
	<resultMap type="bandwidthRI" id="bandwidthRI">
		<result property="riId" column="RI_ID" />
		<result property="riTpId" column="RI_TP_ID" />
		<result property="userId" column="USER_ID" />
		<result property="riGroupId" column="RI_GROUP_ID" />
		<result property="riGroupIp" column="RI_GROUP_IP" />
		<result property="bandwidth" column="BANDWIDTH" />
		<result property="netType" column="NET_TYPE" />
		<result property="vmId" column="VM_ID" />
		<result property="vmName" column="VM_NAME" />
		<result property="status" column="STATUS" />
		<result property="count" column="COUNT" />
		<result property="duration" column="DURATION" />
	</resultMap>
	<select id="selectBandwidthRICountByBandwidth" parameterType="bandwidthRI" resultType="int">
		SELECT
			COUNT(*)
		FROM 
		(
			SELECT
				*
			FROM
				BANDWIDTH_RI
			WHERE
				`STATUS` != 'deleted'
			<if test="netType != null">
			AND
				NET_TYPE = #{netType}
			</if>
			<if test="bandwidth != null">
			AND
				BANDWIDTH = #{bandwidth}
			</if>
			GROUP BY RI_GROUP_ID
		) A;
	</select>
	
	<select id="selectNetType" resultType="String">
		SELECT
			DISTINCT NET_TYPE
		FROM
			BANDWIDTH_RI_TEMPLATE
	</select>
	
	<select id="selectBandwidth" resultType="Integer">
		SELECT
			DISTINCT BANDWIDTH
		FROM
			BANDWIDTH_RI_TEMPLATE
		ORDER BY
			BANDWIDTH
	</select>
	
	<select id="selectBandwidthCountByRIGroupID" resultMap="bandwidthRI">
		SELECT
			min(A.RI_TP_ID) as RI_TP_ID, COUNT(RI_GROUP_ID) AS COUNT, RI_GROUP_ID, DURATION
		FROM
			BANDWIDTH_RI A, BANDWIDTH_RI_TEMPLATE B
		WHERE
		(
			A.`STATUS` = 'bind' || A.`STATUS` = 'unbind'
		)
		AND 
			A.RI_TP_ID = B.RI_TP_ID
		GROUP BY
			A.RI_GROUP_ID
	</select>
</mapper>