<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.snda.cloud.virtulization.resource.dao.IHostVgDao">
	<resultMap id="hostVg" type="hostVg">
		<result property="vgId" column="VG_ID" />
		<result property="vgName" column="VG_NAME" />
		<result property="vgInit" column="VG_INIT" />
		<result property="vgLeft" column="VG_LEFT" />
		<result property="vgTotal" column="VG_TOTAL" />
		<result property="hostId" column="HOST_ID" />
		<result property="deleted" column="IS_DELETED" />
		<result property="enabled" column="IS_ENABLED" />
		<result property="vgReserved" column="VG_RESERVED" />
	</resultMap>
	
	<select id="selectHostVgByHostId" parameterType="String" resultMap="hostVg">
		SELECT
			VG_ID, VG_NAME, VG_INIT, VG_LEFT, VG_TOTAL, HOST_ID, IS_DELETED, 
			IS_ENABLED, VG_RESERVED
		FROM
			HOST_VG
		WHERE
			HOST_ID = #{hostId}
	</select>
	
	<select id="selectAllHostVg" resultMap="hostVg">
		SELECT
			VG_ID, VG_NAME, VG_INIT, VG_LEFT, VG_TOTAL, HOST_ID, IS_DELETED, 
			IS_ENABLED, VG_RESERVED
		FROM
			HOST_VG
	</select>
	
	<select id="selectHostVgTotal" resultType="int">
		SELECT
			SUM(HOST_VG_TOTAL) AS VG_TOTAL
		FROM
			(
				SELECT
					HOST_ID,
					SUM(VG_TOTAL) AS HOST_VG_TOTAL
				FROM
					HOST_VG
				WHERE
					IS_DELETED = 0
				AND IS_ENABLED = 1
				AND HOST_ID IS NOT NULL
				GROUP BY
					HOST_ID
			) A
	</select>
	
	<select id="selectHostVgUsed" resultType="int">
		SELECT
			SUM(DISK) AS DISK_USED
		FROM
			VM_INFO A,
			VM_CONFIG B
		WHERE
			A.VM_TYPE = B.TYPE_ID
		AND A.IS_DELETED = 0
		AND A.IS_ENABLED = 1
	</select>
	
	<select id="selectHostVgLeft" resultType="int">
		SELECT
			SUM(HOST_VG_LEFT) AS VG_LEFT
		FROM
			(
				SELECT
					HOST_ID,
					SUM(VG_LEFT) AS HOST_VG_LEFT
				FROM
					HOST_VG
				WHERE
					IS_DELETED = 0
				AND IS_ENABLED = 1
				AND HOST_ID IS NOT NULL
				GROUP BY
					HOST_ID
			) A 
	</select>
	
	<select id="selectHostVgUnopenTotal" resultType="int">
		SELECT
			SUM(VG_TOTAL) AS UNOPEN_VG_TOTAL
		FROM
			HOST_VG
		WHERE
			HOST_ID IN (
				SELECT
					HOST_ID
				FROM
					HOST_INFO
				WHERE
					`STATUS` != 'Unknown'
				AND IS_ENABLED = 3
				AND FLAG = 'OFFLINE'
			)
		AND IS_DELETED = 0
		AND IS_ENABLED = 1
	</select>
	
	<select id="selectHostVgReserved" resultType="int">
		SELECT
			SUM(VG_RESERVED)
		FROM
			HOST_VG
		WHERE
			IS_DELETED = 0
		AND IS_ENABLED = 1
		AND HOST_ID IS NOT NULL;
	</select>
</mapper>